<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
    <title>DCG Projected Savings Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/dcg-savings-base.css">
    </head>
<body>
    <script>
        (function() {
            const head = document.head;
            const loadStyle = (href) => { const link = document.createElement('link'); link.rel = 'stylesheet'; link.href = href; head.appendChild(link); };
            const mediaQuery = window.matchMedia('(max-width: 768px)');
            const apply = (mq) => {
                if (mq.matches) {
                    document.documentElement.classList.add('dcg-mobile');
                    document.body && document.body.classList.add('dcg-mobile');
                    loadStyle('styles/dcg-savings-mobile.css');
                } else {
                    document.documentElement.classList.remove('dcg-mobile');
                    document.body && document.body.classList.remove('dcg-mobile');
                    loadStyle('styles/dcg-savings-desktop.css');
                }
            };
            apply(mediaQuery);
            mediaQuery.addEventListener('change', apply);
        })();
    </script>

    <header>
        <div class="dcg-hero">
            <img src="DCG-AI-bot-userpic-01.png" alt="DCG" class="dcg-logo" width="90" height="90" />
            <div class="dcg-hero-copy">
                <a class="dcg-back-link" href="index.html">‚Üê Back</a>
                <h1>Projected Savings Calculator</h1>
                <p>Model a fast scenario for your business debt, then share the results with a DCG specialist in one tap.</p>
            </div>
        </div>
    </header>

    <main>
        <div class="dcg-card">
            <section>
                <div class="dcg-section-title">Your details</div>
                <div id="dcg-contact-container"></div>
            </section>

            <section class="dcg-lender-builder">
                <div class="dcg-section-title">Debt portfolio</div>
                <p style="margin: 0; color: #64748B;">Include every creditor you want DCG to negotiate. Use the notes field to mark MCAs or high-priority accounts.</p>
                <div class="dcg-lender-rows" id="dcg-lender-rows"></div>
                <button type="button" class="dcg-add-row" id="dcg-add-lender">Ôºã Add another lender</button>

                <div class="dcg-run-panel">
                    <div class="dcg-actions">
                        <button type="button" id="dcg-run-calculation" class="dcg-primary-button">Run savings estimate</button>
                    </div>
                    <div id="dcg-run-status" class="dcg-status dcg-status-info">Adjust the inputs above and run your estimate when you‚Äôre ready.</div>
                </div>
            </section>

            <section id="dcg-summary-wrapper" class="dcg-summary-wrapper">
                <div class="dcg-summary" id="dcg-summary">
                    <div class="dcg-summary-hero">
                        <span class="dcg-summary-label">Your estimated monthly savings</span>
                        <div class="dcg-summary-value" id="dcg-summary-monthly">$0</div>
                        <p class="dcg-summary-sub">Keep this amount in your business compared to current payments.</p>
                    </div>
                    <div class="dcg-summary-metrics">
                        <div class="dcg-summary-metric">
                            <span>New weekly payment</span>
                            <strong id="dcg-weekly-target">$0</strong>
                            <p>Projected weekly autopay with the DCG plan</p>
                        </div>
                        <div class="dcg-summary-metric">
                            <span>Weekly savings</span>
                            <strong id="dcg-weekly-savings">$0</strong>
                            <p>Less than you pay today</p>
                        </div>
                    </div>
                    <div id="dcg-qualification" class="dcg-qualification dcg-warning">Enter at least $25,000 in unsecured debt to check eligibility.</div>
                    <div id="dcg-interest-cta" class="dcg-summary-cta">
                        <p>Tap ‚ÄúI'm interested in these savings‚Äù to connect with a specialist.</p>
                        <button type="button" id="dcg-interest-button" class="dcg-secondary-button" disabled>I'm interested in these savings</button>
                    </div>
                </div>
            </section>

            <section class="dcg-next-steps">
                <div class="dcg-section-title">What happens after you run the estimate?</div>
                <ul>
                    <li>Review these numbers with a DCG specialist within 24 hours.</li>
                    <li>Gather statements for the lenders you listed so underwriting can finalize the offer.</li>
                    <li>Tap ‚ÄúI‚Äôm interested‚Äù any time to let us know you want a call about this scenario.</li>
                </ul>
            </section>
        </div>
    </main>

    <iframe
        src="dcg-teddy.html?mode=sidebar"
        style="position: fixed; bottom: 32px; right: 16px; width: min(420px, 38vw); max-width: 440px; height: min(640px, 92vh); border: none; border-radius: 22px; box-shadow: 0 28px 60px rgba(20, 184, 166, 0.28); z-index: 9999;"
        title="DCG Assistant Sidebar"
        id="dcgAllyFrameSidebar"
        allow="clipboard-write">
    </iframe>

    <button id="dcgChatToggle" class="dcg-chat-toggle" aria-label="Open chat">üí¨</button>
    <div id="dcgQuickActionsSheet" class="dcg-quick-actions-sheet" aria-hidden="true">
        <div class="dcg-quick-actions-sheet__body">
            <h2>Quick help</h2>
            <p>Pick a topic or type your own question.</p>
            <div class="dcg-quick-actions-sheet__grid">
                <button data-open-chat="true">Open chat window</button>
                <button data-action="calculator">Refresh calculator</button>
                <button data-action="qualify">Do I qualify?</button>
                <button data-action="sales">Talk to a specialist</button>
                <button data-action="help">How DCG helps</button>
                <button data-action="end-session">End chat session</button>
                <button data-action="minimize">Minimize chat</button>
            </div>
            <button class="dcg-quick-actions-sheet__close" type="button">Close</button>
        </div>
    </div>

    <div id="dcgChatBackdrop" class="dcg-chat-backdrop" aria-hidden="true"></div>

    <script>
        const compactMedia = window.matchMedia('(max-width: 960px)');
        let isCompact = compactMedia.matches;
        const contactContainer = document.getElementById('dcg-contact-container');
        const sidebarFrame = document.getElementById('dcgAllyFrameSidebar');
        const chatToggle = document.getElementById('dcgChatToggle');
        const quickSheet = document.getElementById('dcgQuickActionsSheet');
        const quickSheetClose = quickSheet ? quickSheet.querySelector('.dcg-quick-actions-sheet__close') : null;
        const quickSheetButtons = quickSheet ? Array.from(quickSheet.querySelectorAll('[data-action]')) : [];
        const quickSheetOpenButton = quickSheet ? quickSheet.querySelector('[data-open-chat]') : null;
        const chatBackdrop = document.getElementById('dcgChatBackdrop');

        const assistantState = (() => {
            try {
                const raw = sessionStorage.getItem('dcgAssistantSession');
                return raw ? JSON.parse(raw) : null;
            } catch (error) {
                console.warn('Unable to read assistant session', error);
                return null;
            }
        })();

        let revealChatOnCompact = !!(assistantState && (assistantState.shouldAutoOpen || assistantState.isModalOpen));

        if (sidebarFrame && revealChatOnCompact) {
            try {
                const frameUrl = new URL(sidebarFrame.getAttribute('src') || '', window.location.href);
                frameUrl.searchParams.set('chat', 'open');
                sidebarFrame.src = `${frameUrl.pathname}${frameUrl.search}`;
            } catch (error) {
                console.warn('Unable to update sidebar frame URL', error);
            }
        }

        function markAssistantAutoOpenHandled() {
            if (!assistantState) return;
            assistantState.shouldAutoOpen = false;
            try {
                sessionStorage.setItem('dcgAssistantSession', JSON.stringify(assistantState));
            } catch (error) {
                console.warn('Unable to update assistant session', error);
            }
        }

        let isChatVisible = false;
        let isQuickSheetVisible = false;

        function markChatNotification() {
            if (!isCompact || !chatToggle) return;
            chatToggle.classList.add('dcg-notification');
            chatToggle.setAttribute('aria-label', 'Open chat (new message)');
        }

        function clearChatNotification() {
            if (!chatToggle) return;
            chatToggle.classList.remove('dcg-notification');
            if (isCompact) {
                chatToggle.setAttribute('aria-label', isChatVisible ? 'Minimize chat' : 'Open chat');
            } else {
                chatToggle.setAttribute('aria-label', 'Open chat');
            }
            chatToggle.textContent = 'üí¨';
        }

        function setChatBackdrop(mode) {
            if (!chatBackdrop) return;

            if (!isCompact || !mode) {
                chatBackdrop.classList.remove('dcg-visible');
                chatBackdrop.setAttribute('aria-hidden', 'true');
                delete chatBackdrop.dataset.mode;
                return;
            }

            chatBackdrop.dataset.mode = mode;
            chatBackdrop.classList.add('dcg-visible');
            chatBackdrop.setAttribute('aria-hidden', 'false');
        }

        function openQuickSheet() {
            if (!quickSheet || !isCompact) return;
            quickSheet.classList.add('dcg-open');
            quickSheet.setAttribute('aria-hidden', 'false');
            isQuickSheetVisible = true;
            setChatBackdrop('sheet');
            if (chatToggle) {
                chatToggle.style.display = 'flex';
                chatToggle.classList.add('dcg-open');
                chatToggle.setAttribute('aria-label', 'Close quick actions');
            }
            clearChatNotification();
        }

        function closeQuickSheet() {
            if (!quickSheet) return;
            quickSheet.classList.remove('dcg-open');
            quickSheet.setAttribute('aria-hidden', 'true');
            isQuickSheetVisible = false;

            if (!isChatVisible) {
                setChatBackdrop(null);
                if (chatToggle) {
                    chatToggle.classList.remove('dcg-open');
                    chatToggle.setAttribute('aria-label', 'Open chat');
                }
            } else {
                setChatBackdrop('chat');
                if (chatToggle) {
                    chatToggle.classList.add('dcg-open');
                    chatToggle.setAttribute('aria-label', 'Close chat');
                }
            }
        }

        function showMobileChat({ fromAutoReveal = false } = {}) {
            if (!sidebarFrame) return;
            sidebarFrame.style.display = 'block';
            isChatVisible = true;
            closeQuickSheet();

            if (chatToggle) {
                if (isCompact) {
                    chatToggle.style.display = 'none';
                } else {
                    chatToggle.style.display = 'none';
                }
                chatToggle.classList.add('dcg-open');
                chatToggle.setAttribute('aria-label', 'Minimize chat');
            }

            if (isCompact) {
                setChatBackdrop('chat');
            } else {
                setChatBackdrop(null);
            }

            clearChatNotification();

            if (!fromAutoReveal) {
                revealChatOnCompact = false;
                markAssistantAutoOpenHandled();
            }
        }

        function hideMobileChat() {
            if (!sidebarFrame) return;
            sidebarFrame.style.display = 'none';
            isChatVisible = false;

            if (chatToggle) {
                chatToggle.style.display = 'flex';
                chatToggle.classList.remove('dcg-open');
                chatToggle.setAttribute('aria-label', 'Open chat');
            }

            if (isQuickSheetVisible) {
                setChatBackdrop('sheet');
                if (chatToggle) {
                    chatToggle.classList.add('dcg-open');
                    chatToggle.setAttribute('aria-label', 'Close quick actions');
                }
            } else {
                setChatBackdrop(null);
            }

            revealChatOnCompact = false;
            markAssistantAutoOpenHandled();
            clearChatNotification();
        }

        function applySidebarLayout(compact) {
            if (!sidebarFrame) return;
            if (compact) {
                sidebarFrame.style.width = 'calc(100vw - 32px)';
                sidebarFrame.style.left = '16px';
                sidebarFrame.style.right = '16px';
                sidebarFrame.style.height = 'min(80vh, 560px)';
                sidebarFrame.style.bottom = '24px';
                sidebarFrame.style.borderRadius = '20px';
                sidebarFrame.style.display = isChatVisible ? 'block' : 'none';

                const shouldHighlightToggle = isChatVisible || isQuickSheetVisible;
                if (chatToggle) {
                    chatToggle.style.display = 'flex';
                    chatToggle.classList.toggle('dcg-open', shouldHighlightToggle);
                    chatToggle.setAttribute('aria-label', isChatVisible ? 'Close chat' : 'Open chat');
                }

                if (!isChatVisible && !isQuickSheetVisible) {
                    setChatBackdrop(null);
                } else {
                    setChatBackdrop(isChatVisible ? 'chat' : 'sheet');
                }

                if (revealChatOnCompact) {
                    if (!isChatVisible) {
                        markChatNotification();
                    }
                    revealChatOnCompact = false;
                    markAssistantAutoOpenHandled();
                }
            } else {
                sidebarFrame.style.width = 'min(420px, 38vw)';
                sidebarFrame.style.left = '';
                sidebarFrame.style.right = '16px';
                sidebarFrame.style.height = 'min(640px, 92vh)';
                sidebarFrame.style.bottom = '32px';
                sidebarFrame.style.borderRadius = '22px';
                sidebarFrame.style.display = 'block';

                isChatVisible = true;
                isQuickSheetVisible = false;

                if (chatToggle) {
                    chatToggle.style.display = 'none';
                    chatToggle.classList.remove('dcg-open');
                    chatToggle.setAttribute('aria-label', 'Open chat');
                }

                setChatBackdrop(null);
                closeQuickSheet();
                clearChatNotification();

                if (assistantState && assistantState.shouldAutoOpen) {
                    markAssistantAutoOpenHandled();
                }
            }
        }

        applySidebarLayout(isCompact);
        if (compactMedia.addEventListener) {
            compactMedia.addEventListener('change', (event) => {
                isCompact = event.matches;
                applySidebarLayout(isCompact);
            });
        }

        if (chatToggle) {
            chatToggle.addEventListener('click', () => {
                clearChatNotification();

                if (isChatVisible) {
                    hideMobileChat();
                    return;
                }

                if (isQuickSheetVisible) {
                    closeQuickSheet();
                } else {
                    openQuickSheet();
                }
            });
        }

        if (quickSheetClose) {
            quickSheetClose.addEventListener('click', () => {
                closeQuickSheet();
            });
        }

        if (quickSheetOpenButton) {
            quickSheetOpenButton.addEventListener('click', () => {
                closeQuickSheet();
                showMobileChat();
            });
        }

        if (chatBackdrop) {
            chatBackdrop.addEventListener('pointerdown', () => {
                if (!isCompact) return;
                clearChatNotification();
                if (isQuickSheetVisible) {
                    closeQuickSheet();
                } else if (isChatVisible) {
                    hideMobileChat();
                }
            });
        }

        function sendQuickAction(action) {
            try {
                const frame = document.getElementById('dcgAllyFrameSidebar');
                frame.contentWindow.postMessage({ type: 'DCG_QUICK_ACTION', action }, '*');
            } catch (error) {
                console.warn('Unable to send quick action', error);
            }
        }

        quickSheetButtons.forEach(button => {
            button.addEventListener('click', () => {
                const action = button.getAttribute('data-action');
                if (!action) return;

                if (action === 'minimize') {
                    hideMobileChat();
                    closeQuickSheet();
                    return;
                }

                closeQuickSheet();

                if (action === 'calculator') {
                    window.location.href = 'dcg-savings-workshop.html';
                    return;
                }

                showMobileChat();
                sendQuickAction(action);
            });
        });

        window.addEventListener('message', (event) => {
            if (!event || !event.data) return;
            if (event.data.type === 'DCG_CLOSE_SIDEBAR') {
                hideMobileChat();
                closeQuickSheet();
            }
        });
        const lenderRowsEl = document.getElementById('dcg-lender-rows');
        const addRowBtn = document.getElementById('dcg-add-lender');
        const runButton = document.getElementById('dcg-run-calculation');
        const interestCta = document.getElementById('dcg-interest-cta');
        const interestButton = document.getElementById('dcg-interest-button');
        const statusEl = document.getElementById('dcg-run-status');
        const summaryWrapper = document.getElementById('dcg-summary-wrapper');
        const summaryCard = document.getElementById('dcg-summary');

        const monthlySavingsEl = document.getElementById('dcg-summary-monthly');
        const weeklyTargetEl = document.getElementById('dcg-weekly-target');
        const weeklySavingsEl = document.getElementById('dcg-weekly-savings');
        const qualificationEl = document.getElementById('dcg-qualification');

        let hasRun = false;
        let isDirty = false;

        const contactPayload = (() => {
            try {
                const raw = sessionStorage.getItem('dcgCalculatorContact');
                return raw ? JSON.parse(raw) : null;
            } catch (error) {
                console.warn('Unable to read contact payload', error);
                return null;
            }
        })();

        const defaultContactCopy = `
            <div class="dcg-contact-note">
                <div class="dcg-contact-note-message">You're all set to model savings. Adjust the debt details below and run the estimate whenever you're ready.</div>
            </div>
        `;

        contactContainer.innerHTML = defaultContactCopy;

        function escapeHTML(value = '') {
            return (value || '').replace(/[&<>"']/g, (char) => {
                const entities = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                };
                return entities[char] || char;
            });
        }

        function formatReadablePhone(phone) {
            const digits = (phone || '').replace(/\D/g, '');
            if (digits.length === 10) {
                return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
            }
            return phone || '';
        }

        if (contactPayload) {
            const { name, businessName, phone, email } = contactPayload;

            const summaryItems = [];
            if (businessName) {
                summaryItems.push({ label: 'Business', value: escapeHTML(businessName) });
            }
            if (name) {
                summaryItems.push({ label: 'Contact', value: escapeHTML(name) });
            }

            const phoneDisplay = formatReadablePhone(phone);
            if (phoneDisplay) {
                summaryItems.push({ label: 'Phone', value: escapeHTML(phoneDisplay) });
            }
            if (email) {
                summaryItems.push({ label: 'Email', value: escapeHTML(email) });
            }

            const summaryHtml = summaryItems.map(({ label, value }) => `
                <div class="dcg-contact-summary-item">
                    <span class="dcg-contact-summary-label">${label}</span>
                    <span class="dcg-contact-summary-value">${value}</span>
                </div>
            `).join('');

            contactContainer.innerHTML = `
                <div class="dcg-contact-note">
                    ${summaryHtml ? `<div class="dcg-contact-summary">${summaryHtml}</div>` : ''}
                    <div class="dcg-contact-note-message">You're all set to model savings. Adjust the debt details below and run the estimate whenever you're ready.</div>
                </div>
            `;
        }

        function createLenderRow(initial = {}) {
            const row = document.createElement('div');
            row.className = 'dcg-lender-row';

            row.innerHTML = `
                <div class="dcg-lender-field">
                    <label>Creditor</label>
                    <input type="text" class="dcg-input" data-field="name" placeholder="e.g. Fundbox" value="${initial.name || ''}">
                </div>
                <div class="dcg-lender-field">
                    <label>Current balance</label>
                    <input type="text" class="dcg-input" data-field="balance" placeholder="$75,000" value="${initial.balance || ''}">
                </div>
                <div class="dcg-lender-field">
                    <label>Payment frequency</label>
                    <select class="dcg-select" data-field="frequency">
                        <option value="daily" ${initial.frequency === 'daily' ? 'selected' : ''}>Daily (ACH)</option>
                        <option value="weekly" ${!initial.frequency || initial.frequency === 'weekly' ? 'selected' : ''}>Weekly</option>
                        <option value="biweekly" ${initial.frequency === 'biweekly' ? 'selected' : ''}>Biweekly</option>
                        <option value="monthly" ${initial.frequency === 'monthly' ? 'selected' : ''}>Monthly</option>
                    </select>
                </div>
                <div class="dcg-lender-field">
                    <label>Payment amount</label>
                    <input type="text" class="dcg-input" data-field="amount" placeholder="$2,500" value="${initial.amount || ''}">
                </div>
                <div class="dcg-lender-field">
                    <label>Notes</label>
                    <input type="text" class="dcg-input" data-field="notes" placeholder="Optional (e.g. MCA)">
                </div>
                <button type="button" class="dcg-remove-row" title="Remove lender">Remove</button>
            `;

            row.querySelector('.dcg-remove-row').addEventListener('click', () => {
                if (lenderRowsEl.children.length > 1) {
                    row.remove();
                    markDirty();
                }
            });

            ['input', 'change'].forEach(evt => {
                row.addEventListener(evt, () => markDirty());
            });

            lenderRowsEl.appendChild(row);
        }

        function parseCurrency(value) {
            if (!value) return 0;
            const num = parseFloat(value.toString().replace(/[^0-9.]/g, ''));
            return Number.isFinite(num) ? num : 0;
        }

        function convertToWeekly(amount, frequency) {
            switch (frequency) {
                case 'daily':
                    return amount * 5;
                case 'biweekly':
                    return amount / 2;
                case 'monthly':
                    return amount / 4.33;
                default:
                    return amount;
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 0
            }).format(Math.round(value || 0));
        }

        function qualificationMessage(totalBalance, weeklyTarget) {
            if (totalBalance < 25000) {
                if (totalBalance === 0) {
                    return {
                        text: 'Add unsecured balances above $25,000 to preview DCG savings.',
                        warning: true
                    };
                }

                return {
                    text: `This scenario totals ${formatCurrency(totalBalance)}. DCG programs usually start at $25K in unsecured debt, but we can share partner options if you need them.`,
                    warning: true
                };
            }

            if (weeklyTarget < 500) {
                return {
                    text: `Weekly payments could land around ${formatCurrency(weeklyTarget)}. We‚Äôll double-check minimum thresholds with underwriting on your follow-up call.`,
                    warning: false
                };
            }

            return {
                text: 'Great news! You qualify for a savings review. Tap ‚ÄúI‚Äôm interested‚Äù and we‚Äôll connect you with a specialist to finalize the plan.',
                warning: false
            };
        }

        function calculateMetrics() {
            const rows = Array.from(lenderRowsEl.querySelectorAll('.dcg-lender-row'));

            let totalBalance = 0;
            let totalWeeklyPayments = 0;

            rows.forEach(row => {
                const balance = parseCurrency(row.querySelector('[data-field="balance"]').value);
                const amount = parseCurrency(row.querySelector('[data-field="amount"]').value);
                const frequency = row.querySelector('[data-field="frequency"]').value;

                totalBalance += balance;
                totalWeeklyPayments += convertToWeekly(amount, frequency);
            });

            const weeklyTarget = totalWeeklyPayments * 0.4463;
            const weeklySavings = Math.max(totalWeeklyPayments - weeklyTarget, 0);
            const monthlySavings = weeklySavings * 4.33;

            return {
                totalBalance,
                totalWeeklyPayments,
                weeklyTarget,
                weeklySavings,
                monthlySavings
            };
        }

        function applyMetrics(metrics) {
            monthlySavingsEl.textContent = formatCurrency(metrics.monthlySavings);
            weeklyTargetEl.textContent = formatCurrency(metrics.weeklyTarget);
            weeklySavingsEl.textContent = formatCurrency(metrics.weeklySavings);

            const qual = qualificationMessage(metrics.totalBalance, metrics.weeklyTarget);
            qualificationEl.textContent = qual.text;
            qualificationEl.classList.toggle('dcg-warning', qual.warning);
        }

        function updateStatus(message, state = 'info') {
            statusEl.textContent = message;
            statusEl.classList.remove('dcg-status-info', 'dcg-status-dirty');
            statusEl.classList.add(state === 'dirty' ? 'dcg-status-dirty' : 'dcg-status-info');
        }

        function markDirty() {
            if (!hasRun) {
                return;
            }
            if (!isDirty) {
                isDirty = true;
                updateStatus('Inputs updated. Click ‚ÄúRun savings estimate‚Äù to refresh.', 'dirty');
                interestButton.disabled = true;
                interestButton.textContent = "I'm interested in these savings";
                if (interestCta && hasRun) {
                    interestCta.style.display = 'block';
                }
            }
        }

        function launchConfetti() {
            if (isCompact) {
                return;
            }
            const colors = ['#0B3C3E', '#14B8A6', '#06B6D4', '#F59E0B', '#10B981', '#EF4444'];
            for (let i = 0; i < 24; i++) {
                const piece = document.createElement('span');
                piece.className = 'dcg-confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = (Math.random() * 0.4) + 's';
                summaryCard.appendChild(piece);
                setTimeout(() => piece.remove(), 1400);
            }
        }

        addRowBtn.addEventListener('click', () => {
            createLenderRow();
            markDirty();
        });

        runButton.addEventListener('click', () => {
            const metrics = calculateMetrics();
            applyMetrics(metrics);
            hasRun = true;
            isDirty = false;
            updateStatus('Estimates updated just now.', 'info');
            summaryWrapper.classList.add('dcg-visible');
            if (interestCta) {
                interestCta.style.display = 'block';
            }
            interestButton.disabled = false;
            interestButton.textContent = "I'm interested in these savings";
            launchConfetti();
        });

        interestButton.addEventListener('click', () => {
            try {
                const frame = document.getElementById('dcgAllyFrameSidebar');
                frame.contentWindow.postMessage({ type: 'DCG_INTEREST' }, '*');
                interestButton.textContent = "Thank you! We'll be in touch";
                interestButton.disabled = true;
                if (isCompact && !isChatVisible) {
                    markChatNotification();
                }
            } catch (error) {
                console.warn('Unable to notify assistant', error);
            }
        });

        createLenderRow({ name: 'Creditor 1', balance: '75000', amount: '2500', frequency: 'weekly' });
        createLenderRow({ name: 'Creditor 2', balance: '50000', amount: '1800', frequency: 'daily' });
    </script>
</body>
</html>
